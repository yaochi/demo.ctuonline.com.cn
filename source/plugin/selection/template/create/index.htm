<script type="text/javascript" src="{$_G['setting']['jspath']}forum_post.js?{VERHASH}"></script>
<script type="text/javascript" src="{$_G['setting']['jspath']}forum.js?{VERHASH}"></script>
<script type="text/javascript" src="{$_G['setting']['jspath']}forum_calendar.js?{VERHASH}"></script>

<form action="{eval echo join_plugin_action2('create')}" method="post" enctype="multipart/form-data" onsubmit="return validate(this);">
	<input type="hidden" name="fid" value="$_G[fid]"/>
	<input type="hidden" name="wysiwyg" id="{$editorid}_mode" value="$editormode" />
<div class="mn">
<div class="bm cl">
    <h1 class="mt"><img alt="live" src="static/image/plugins/selection.gif" width="16" height="16" class="vm"> 创建评选</h1>
	<div class="c_ny_czgg" style="padding:20px 0 80px;"><table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="15%" height="42" align="right"><strong class="rq y mlngroup"> * </strong><strong>标题:</strong></td>
    <td width="85%">

      <input type="text" tabindex="1" onblur="checkgroupname()" autocomplete="off" value="" size="36" class="px" id="selectionname" name="selectionname">
</td>
  </tr>
  <tr>
    <td height="42" align="right" valign="top"><strong class="rq y mlngroup"> * </strong><strong>简介:</strong></td>
    <td><div class="edt" style="width:600px">
						<div id="{$editorid}_controls" class="bar">
					<span id="{$editorid}_switcher" class="y">
						<label><input type="checkbox" class="pc" name="checkbox" value="0" {if !$editor[editormode]}checked="checked"{/if} onclick="switchEditor(this.checked?0:1)" />纯文本</label><br />
						<a id="{$editorid}_fullswitcher"></a>
					</span>
					<div class="btn cl">
						<div class="b1r">
							<a id="{$editorid}_paste" title="{lang e_paste}">{lang e_paste}</a>
						</div>
						<div class="b2r">
							<a id="{$editorid}_undo" title="{lang e_undo}">Undo</a>
							<a id="{$editorid}_redo" title="{lang e_redo}">Redo</a>
							<p>
								<a id="{$editorid}_svd" title="{lang post_savedata}">Savedata</a>
								<a id="{$editorid}_rst" title="{lang post_autosave_restore}">Loaddata</a>
							</p>
						</div>
						<div class="b2r">
							<a id="{$editorid}_smp" title="{lang e_bold}">B</a>
							<a id="{$editorid}_fontname" title="{lang e_fontname}">Font</a>
							<a id="{$editorid}_fontsize" title="{lang e_fontsize}">Size</a>
							<a id="{$editorid}_forecolor" title="{lang e_forecolor}">Color</a>
							<p>
								<a id="{$editorid}_tbl" title="{lang e_table}">Table</a>
								<a id="{$editorid}_chck" title="{lang post_check_length}">Checklength</a>
								<a id="{$editorid}_removeformat" title="{lang e_removeformat}">Removeformat</a>
								<a id="{$editorid}_tpr" title="{lang post_topicreset}">Clearcontent</a>
							</p>
						</div>
						<div class="b2r">
							<a id="{$editorid}_url" title="{lang e_url}">Url</a>
							<a id="{$editorid}_prg" title="{lang e_paragraph}">P</a>
							<!--{if $isfirstpost && $_G['group']['allowhidecode']}-->
								<a id="{$editorid}_hide" title="{lang e_hide}">Hide</a>
							<!--{/if}-->
							<p>
								<a id="{$editorid}_unlink" title="{lang e_unlink}">Unlink</a>
								<a id="{$editorid}_lst" title="{lang e_list}">List</a>
							</p>
						</div>

						<div class="b1r">
							<a id="{$editorid}_sml" title="{lang e_smilies_title}">{lang e_smilies}</a>
								<div id="{$editorid}_imagen" style="display:none">!</div>
								<a id="{$editorid}_image" title="{lang e_image_title}">{lang e_image}</a>
								<!--{if $_G['group']['allowpostattach']}-->
									<div id="{$editorid}_attachn" style="display:none">!</div>
									<a id="{$editorid}_attach" title="{lang e_attach_title}">{lang e_attach}</a>
								<!--{/if}-->
								<!--{if $_G['forum']['allowmediacode']}-->
									<a id="{$editorid}_aud" title="{lang e_audio_title}">{lang e_audio}</a>
									<a id="{$editorid}_vid" title="{lang e_video_title}">{lang e_video}</a>
									<a id="{$editorid}_fls" title="{lang e_flash_title}">{lang e_flash}</a>
								<!--{/if}-->
								<a id="{$editorid}_code" title="{lang e_code_title}">{lang e_code}</a>
								<a id="{$editorid}_quote" title="{lang e_quote_title}">{lang e_quote}</a>
						</div>
						<!--{if $_G['forum']['allowbbcode'] && $_G['group']['allowcusbbcode'] && $_G['cache']['bbcodes_display'] || !empty($_G['setting']['magics']['doodle'])}-->
						<div class="b2r">
							<p>
								<!--{if !empty($_G['setting']['magics']['doodle'])}-->
									<a id="a_magic_doodle" href="../../../questionary/template/create/home.php?mod=magic&amp;mid=doodle&amp;showid=comment_doodle&amp;target={$editorid}_textarea&amp;from=forumeditor" class="cst" onclick="showWindow(this.id, this.href, 'get', 0)"><img src="../../../questionary/template/create/{STATICURL}image/magic/doodle.small.gif" alt="doodle" title="$_G['setting']['magics']['doodle']" /></a>
								<!--{/if}-->
								<!--{loop $_G['cache']['bbcodes_display'] $tag $bbcode}-->
									<!--{if $bbcode['i'] % 2 != 0}--><a id="{$editorid}_cst{$bbcode[params]}_$tag" class="cst" title="$bbcode[explanation]"><img src="../../../questionary/template/create/{STATICURL}image/common/$bbcode[icon]" title="$bbcode[explanation]" alt="$tag" /></a><!--{/if}-->
								<!--{/loop}-->
								{hook/post_editorctrl_top}
							</p>
							<p>
								<!--{loop $_G['cache']['bbcodes_display'] $tag $bbcode}-->
									<!--{if $bbcode['i'] % 2 == 0}--><a id="{$editorid}_cst{$bbcode[params]}_$tag" class="cst" title="$bbcode[explanation]"><img src="../../../questionary/template/create/{STATICURL}image/common/$bbcode[icon]" title="$bbcode[explanation]" alt="$tag" /></a><!--{/if}-->
								<!--{/loop}-->
								{hook/post_editorctrl_bottom}
							</p>
						</div>
						<!--{/if}-->
					</div>
				</div>
		
						<div class="area">
                            <textarea name="$editor[textarea]" id="{$editorid}_textarea" class="pt" tabindex="1" rows="15">$editor[value]</textarea>
                        </div>
                        {subtemplate common/editor}
					</div></td>
  </tr>
  <!--{if $is_enable_category}-->
<tr>
<td height="42" align="right"><strong class="rq y mlngroup"> * </strong><strong>评选分类:</strong></td>
<td>
    <select name="category">
		<!-- {if !$required} --> <option value="0">--请选择--</option><!-- {/if} -->
        <!-- {loop $categorys $id $cat}-->
        <option value="$id">$cat[name]</option>
        <!--{/loop}-->
    </select>
</td>
</tr>
<!--{/if}-->
<tr>
<td height="42" align="right"><strong class="rq y mlngroup"> * </strong><strong>评选时间:</strong></td>
<td>
    <input type="text" onblur="javascript:checkVoteNum(this.value);" onclick="showcalendar(event, this, true)" autocomplete="on" value="" tabindex="1" size="15" class="zbbjan2" id="selectionstartdate" name="selectionstartdate">
   ~ 
    
    <input type="text" onclick="showcalendar(event, this, true)" autocomplete="on" value="" tabindex="1" size="15" class="zbbjan2" id="selectionenddate" name="selectionenddate">
</td>
</tr>
<tr>
<td height="42" align="right"><strong class="rq y mlngroup"> * </strong><strong>投票规则:</strong></td>
<td>
    用户最多可投
    <input name="voteNum" type="text" class="zbbjan2" id="voteNum" tabindex="1" onblur="javascript:checkVoteNum(this.value);" onkeyup="this.value=this.value.replace(/\D/g,'');this.value>0?this.value=this.value:this.value=''" value="" size="3" style="width:30px;">
    票
</td>
</tr>
<tr id="votecreatetimeTr" style="display:none">
<td height="42" align="right">&nbsp;</td>
<td>
    <input type="checkbox" name="votecreatetimeFlag" id="votecreatetimeFlag" onclick="javascript:createtimeChecked(this.checked);"/>&nbsp;每隔&nbsp;
    <input type="text" onchange="javascript:checkVotecreatetime();" onkeyup="this.value=this.value.replace(/\D/g,'');this.value>0?this.value=this.value:this.value=''" autocomplete="on" value="" tabindex="1" size="15" class="px" id="votecreatetime" name="votecreatetime">
    
	<select name="votecreatetype" id="votecreatetype">
		<option value="0">分钟</option>
		<option value="1">小时</option>
		<option value="2">天</option>
	</select>
	生成投票机会
</td>
</tr>
<tr id="votebatchflagTr" style="display:none">
<td height="42" align="right">&nbsp;</td>
<td>
    <input type="checkbox" name="votebatchflag" id="votebatchflag" onclick="javascript:votebatchChecked(this.checked);" value="1"/>&nbsp;投票可分批完成
</td>
</tr>
<tr id="voterepeatflagTr" style="display:none">
<td height="42" align="right">&nbsp;</td>
<td>
     <input type="checkbox" name="voterepeatflag" id="voterepeatflag" value="1"/>&nbsp;选项可被重复投票
</td>
</tr>
<tr >
<td height="42" align="right"><strong>背景图片:</strong></td>
<td>
    <input type="file" name="imgurl" id="imgurl" size="50" onchange="document.getElementById('checkimg').value=this.value"/>
	 <input type="hidden" name="checkimg" id="checkimg" size="50"/>
</td>
</tr>
  <tr>
    <td height="42" align="right">&nbsp;</td>
    <td><label>
      <button class="pn vm" type="submit" name="submit"><em>保存并继续</em></button>
    </label></td>
  </tr>
</table>
</div>
	</div>
	</div>
	<div id="psd" class="sd">
<div class="h bbs"><h3 class="bn">附加选项</h3></div>
<div class="bn">

<p class="mbn"><input type="checkbox" name="showvoteflag" id="showvoteflag" value="1" class="pc"> <label for="scored">显示选项已有票数</label></p>
<p class="mbn"><input type="checkbox" name="showrecordflag" id="showrecordflag" value="1" class="pc"> <label for="makefeed">无记名投票</label></p>
</div>
</div>
</div>
</div>
</form>
<div id="{$editorid}_menus" class="editorrow" style="overflow: hidden; margin-top: -5px; height: 0; border: none; background: transparent;">
	{subtemplate common/editor_menu}
	{subtemplate forum/editor_menu_forum}
</div>

<script>
	function validate(obj){
		editorsubmit(obj);
		var name=document.getElementById("selectionname").value;
		var descr=document.getElementById('{$editorid}_textarea').value;
		var startdate = document.getElementById("selectionstartdate").value;
		var enddate = document.getElementById("selectionenddate").value;
		var voteNum = document.getElementById("voteNum").value;
		if(name==''){
			showDialog("标题不能为空");
			return false;
		}
		if(trim(descr)==''){
			showDialog("简介不能为空");
			return false;
		}
	 
		if(trim(startdate)==''){
			showDialog("评选开始时间不能为空");
			return false;
		}
		if(trim(enddate)==''){
			showDialog("评选结束时间不能为空");
			return false;
		}
	   	startdate = parsedate(startdate);
        enddate = parsedate(enddate);
		if(startdate>=enddate){
            showDialog('活动结束时间必须大于开始时间');
            return false;
        }
		if(trim(voteNum)==''){
			showDialog("投票数不能为空");
			return false;
		}
		
		if(name!=''&&descr!=''&&startdate!=''&&enddate!=''&&voteNum!=''){
			return true;
		}
		return false;
	}

	function checkVoteNum(voteNum){
		if(voteNum==1){
			document.getElementById("votecreatetimeTr").style.display="";
			document.getElementById("votecreatetimeFlag").disabled="";
			clear();
		}
		if(voteNum>1){
			document.getElementById("votecreatetimeTr").style.display="";
			document.getElementById("votebatchflagTr").style.display="";
			document.getElementById("voterepeatflagTr").style.display="";
			if(document.getElementById("votecreatetimeFlag").checked){
				document.getElementById("votebatchflag").disabled="true";
			}
		}
	}
	function createtimeChecked(checked){
		if(checked){
			document.getElementById("votebatchflag").checked="";
			document.getElementById("votebatchflag").disabled="true";
		}else{
			document.getElementById("votebatchflag").disabled="";
		}
	}
	function votebatchChecked(checked){
		if(checked){
			document.getElementById("votecreatetimeFlag").checked="";
			document.getElementById("votecreatetimeFlag").disabled="true";
			document.getElementById("votecreatetime").value="";
			document.getElementById("votecreatetime").disabled="true";
		}else{
			document.getElementById("votecreatetimeFlag").disabled="";
			document.getElementById("votecreatetime").disabled="";
		}
	}
	function clear(){
		document.getElementById("votebatchflag").disabled="";
		document.getElementById("votebatchflag").checked="";
		document.getElementById("voterepeatflag").checked="";
		document.getElementById("votebatchflagTr").style.display="none";
		document.getElementById("voterepeatflagTr").style.display="none";
	}
 	function checkVotecreatetime(){
		if(!document.getElementById("votebatchflag").checked){
			document.getElementById("votecreatetimeFlag").checked="true";
			document.getElementById("votebatchflag").checked="";
			document.getElementById("votebatchflag").disabled="true";
		}
	}
</script>